<!DOCTYPE html>
<html lang="fa" dir="rtl" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>سامانه رصد هوشمند | Intel Radar</title>
    
    <!-- Fonts -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@33.003/misc/Farsi-Digits/Vazirmatn-FD-font-face.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Vazirmatn', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        dark: {
                            900: '#050507',
                            800: '#0e0e12',
                            700: '#18181b',
                        },
                        neon: {
                            blue: '#0a84ff',
                            red: '#ff3b30',
                            green: '#30d158',
                            purple: '#bf5af2',
                            orange: '#ff9f0a'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 1.5s infinite linear',
                        'scroll': 'scroll 80s linear infinite',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { backgroundPosition: '200% 0' },
                            '100%': { backgroundPosition: '-200% 0' }
                        },
                        scroll: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(50%)' }
                        }
                    }
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .scrollbar-hide::-webkit-scrollbar { display: none; }
            .glass { @apply bg-dark-800/80 backdrop-blur-md border border-white/5; }
            .card-hover { @apply transition-all duration-300 hover:-translate-y-1 hover:border-white/20; }
        }
        body {
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(10, 132, 255, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 59, 48, 0.03) 0%, transparent 20%);
        }
    </style>
</head>
<body class="bg-dark-900 text-gray-200 font-sans min-h-screen overflow-x-hidden selection:bg-neon-blue/20 selection:text-neon-blue">

<div class="max-w-[1600px] mx-auto p-4 lg:p-6 grid lg:grid-cols-[300px_1fr] gap-6 relative">
    
    <!-- HEADER -->
    <header class="lg:col-span-2 sticky top-0 z-50 glass rounded-2xl p-4 flex justify-between items-center shadow-lg shadow-black/50">
        <div class="flex items-center gap-3">
            <div class="relative w-3 h-3">
                <span class="absolute inline-flex h-full w-full rounded-full bg-neon-red opacity-75 animate-ping"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-neon-red"></span>
            </div>
            <h1 class="font-black text-xl tracking-tight">Rasad<span class="text-gray-600 font-light">.AI</span></h1>
        </div>
        
        <div id="sys-status" class="flex items-center gap-2 px-3 py-1 rounded-full bg-neon-blue/10 border border-neon-blue/20 text-neon-blue text-xs font-mono">
            <i class="fas fa-satellite-dish animate-pulse"></i> CONNECTING...
        </div>
    </header>

    <!-- TICKER -->
    <div class="lg:col-span-2 bg-dark-800 border border-white/5 rounded-xl h-10 flex items-center overflow-hidden relative">
        <div id="ticker-content" class="flex whitespace-nowrap animate-scroll min-w-full">
            <span class="px-8 text-sm text-gray-500">در حال دریافت داده‌های زنده...</span>
        </div>
    </div>

    <!-- SIDEBAR -->
    <aside class="space-y-4 order-2 lg:order-1">
        
        <!-- Market -->
        <div class="glass rounded-2xl p-5">
            <h4 class="text-xs font-bold text-gray-500 mb-4 flex items-center gap-2">
                <i class="fas fa-chart-line"></i> بازار مالی
            </h4>
            <div class="space-y-3">
                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                    <span class="text-sm text-gray-400">دلار تهران</span>
                    <span id="price-usd" class="font-mono font-bold text-gray-200">...</span>
                </div>
                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                    <span class="text-sm text-gray-400">بیت‌کوین</span>
                    <span id="price-btc" class="font-mono font-bold text-gray-200">...</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-sm text-gray-400">تتر</span>
                    <span id="price-usdt" class="font-mono font-bold text-gray-200">...</span>
                </div>
            </div>
        </div>

        <!-- Tension Meter -->
        <div class="glass rounded-2xl p-5">
            <div class="flex justify-between items-center mb-2">
                <span class="text-[10px] font-bold text-gray-500 tracking-wider">TENSION LEVEL (AI)</span>
                <span id="tension-text" class="text-xs font-black text-gray-300">ANALYZING</span>
            </div>
            <div class="h-1.5 w-full bg-white/5 rounded-full overflow-hidden">
                <div id="tension-fill" class="h-full bg-neon-green w-0 transition-all duration-1000 ease-out shadow-[0_0_10px_currentColor]"></div>
            </div>
        </div>

        <!-- Tools -->
        <div class="glass rounded-2xl p-5">
            <h4 class="text-xs font-bold text-gray-500 mb-4 flex items-center gap-2">
                <i class="fas fa-toolbox"></i> ابزارهای رصد
            </h4>
            <div class="grid grid-cols-2 gap-2">
                <a href="https://firms.modaps.eosdis.nasa.gov/" target="_blank" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-neon-blue/10 hover:border-neon-blue/30 border border-transparent transition-all group">
                    <i class="fas fa-fire text-lg text-gray-400 group-hover:text-neon-blue"></i>
                    <span class="text-[10px] text-gray-400">NASA FIRE</span>
                </a>
                <a href="https://www.flightradar24.com/" target="_blank" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-neon-blue/10 hover:border-neon-blue/30 border border-transparent transition-all group">
                    <i class="fas fa-plane text-lg text-gray-400 group-hover:text-neon-blue"></i>
                    <span class="text-[10px] text-gray-400">FLIGHT RADAR</span>
                </a>
                <a href="https://twitter.com/search?q=Iran&f=live" target="_blank" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-neon-blue/10 hover:border-neon-blue/30 border border-transparent transition-all group">
                    <i class="fab fa-twitter text-lg text-gray-400 group-hover:text-neon-blue"></i>
                    <span class="text-[10px] text-gray-400">SOCIAL INTEL</span>
                </a>
                <a href="https://netblocks.org/" target="_blank" class="flex flex-col items-center gap-2 p-3 rounded-xl bg-white/5 hover:bg-neon-blue/10 hover:border-neon-blue/30 border border-transparent transition-all group">
                    <i class="fas fa-wifi text-lg text-gray-400 group-hover:text-neon-blue"></i>
                    <span class="text-[10px] text-gray-400">NETBLOCKS</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- MAIN FEED -->
    <main class="flex flex-col gap-6 order-1 lg:order-2">
        
        <!-- Clocks -->
        <div class="grid grid-cols-3 gap-3">
            <div class="glass rounded-xl p-3 text-center">
                <span class="text-[10px] text-gray-500 block mb-1">TEHRAN</span>
                <span id="clock-teh" class="font-mono font-bold text-xl text-gray-200">--:--</span>
            </div>
            <div class="glass rounded-xl p-3 text-center">
                <span class="text-[10px] text-gray-500 block mb-1">TEL AVIV</span>
                <span id="clock-tlv" class="font-mono font-bold text-xl text-gray-200">--:--</span>
            </div>
            <div class="glass rounded-xl p-3 text-center">
                <span class="text-[10px] text-gray-500 block mb-1">WASH DC</span>
                <span id="clock-dc" class="font-mono font-bold text-xl text-gray-200">--:--</span>
            </div>
        </div>

        <!-- Filter Chips -->
        <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide mask-fade">
            <button onclick="filterFeed('all', this)" class="chip active whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border transition-colors bg-gray-200 text-black border-gray-200">همه گزارش‌ها</button>
            <button onclick="filterFeed('نظامی', this)" class="chip whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border border-white/10 text-gray-400 hover:border-white/30 hover:text-white transition-colors">نظامی</button>
            <button onclick="filterFeed('هسته‌ای', this)" class="chip whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border border-white/10 text-gray-400 hover:border-white/30 hover:text-white transition-colors">هسته‌ای</button>
            <button onclick="filterFeed('اقتصادی', this)" class="chip whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border border-white/10 text-gray-400 hover:border-white/30 hover:text-white transition-colors">اقتصادی</button>
            <button onclick="filterFeed('سیاسی', this)" class="chip whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border border-white/10 text-gray-400 hover:border-white/30 hover:text-white transition-colors">سیاسی</button>
        </div>

        <!-- News Feed -->
        <div id="feed-container" class="space-y-4">
            <!-- Skeleton Loader -->
            <div class="h-28 w-full rounded-2xl bg-gradient-to-r from-dark-800 via-dark-700 to-dark-800 bg-[length:200%_100%] animate-shimmer"></div>
            <div class="h-28 w-full rounded-2xl bg-gradient-to-r from-dark-800 via-dark-700 to-dark-800 bg-[length:200%_100%] animate-shimmer"></div>
        </div>

    </main>

</div>

<script>
    /* --- STATE --- */
    let newsData = [];
    let currentFilter = 'all';

    /* --- 1. CLOCKS --- */
    function updateClocks() {
        const now = new Date();
        const fmt = (tz) => new Intl.DateTimeFormat('en-GB', { timeZone: tz, hour: '2-digit', minute: '2-digit', hour12: false }).format(now);
        document.getElementById('clock-teh').innerText = fmt('Asia/Tehran');
        document.getElementById('clock-tlv').innerText = fmt('Asia/Jerusalem');
        document.getElementById('clock-dc').innerText = fmt('America/New_York');
    }
    setInterval(updateClocks, 1000);
    updateClocks();

    /* --- 2. MARKET --- */
    async function fetchMarket() {
        try {
            const r = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,tether&vs_currencies=usd');
            const d = await r.json();
            document.getElementById('price-btc').innerText = `$${(d.bitcoin.usd/1000).toFixed(1)}k`;
            document.getElementById('price-usdt').innerText = `$${d.tether.usd.toFixed(2)}`;
        } catch(e) {}

        try {
            const r = await fetch('market.json?t=' + Date.now());
            const d = await r.json();
            document.getElementById('price-usd').innerText = d.usd + " T";
        } catch(e) { document.getElementById('price-usd').innerText = "N/A"; }
    }
    fetchMarket();
    setInterval(fetchMarket, 60000);

    /* --- 3. FEED LOGIC --- */
    async function loadData() {
        try {
            const res = await fetch('news.json?t=' + Date.now());
            const data = await res.json();
            if (JSON.stringify(data) !== JSON.stringify(newsData)) {
                newsData = data;
                renderFeed();
                updateTicker();
                updateTension(data);
                const s = document.getElementById('sys-status');
                s.innerHTML = '<i class="fas fa-check-circle"></i> SYSTEM ONLINE';
                s.className = "flex items-center gap-2 px-3 py-1 rounded-full bg-neon-green/10 border border-neon-green/20 text-neon-green text-xs font-mono";
            }
        } catch (e) { console.error(e); }
    }

    function getTagStyles(tag) {
        if(tag.includes('نظامی')) return 'bg-neon-red/10 text-neon-red border-neon-red/20';
        if(tag.includes('هسته‌ای')) return 'bg-neon-orange/10 text-neon-orange border-neon-orange/20';
        if(tag.includes('اقتصادی')) return 'bg-neon-green/10 text-neon-green border-neon-green/20';
        if(tag.includes('سیاسی')) return 'bg-neon-blue/10 text-neon-blue border-neon-blue/20';
        return 'bg-white/5 text-gray-400 border-white/10';
    }

    function renderFeed() {
        const root = document.getElementById('feed-container');
        const filtered = currentFilter === 'all' ? newsData : newsData.filter(n => n.tag && n.tag.includes(currentFilter));

        if(filtered.length === 0) {
            root.innerHTML = '<div class="text-center py-10 text-gray-600 text-sm">گزارشی موجود نیست</div>';
            return;
        }

        let html = '';
        filtered.forEach((item, index) => {
            // REMOVED IMAGE VARIABLES HERE
            const summaryHTML = Array.isArray(item.summary) 
                ? item.summary.map(s => `<li class="mb-1">${s}</li>`).join('') 
                : `<li>${item.summary || 'تحلیل موجود نیست'}</li>`;
            
            // Sentiment Color for strip
            let sColor = 'bg-gray-600';
            if(item.sentiment > 0.2) sColor = 'bg-neon-green';
            else if(item.sentiment < -0.2) sColor = 'bg-neon-red';

            html += `
            <article id="card-${index}" class="glass rounded-2xl overflow-hidden relative group card-hover flex flex-col min-h-[140px]">
                
                <!-- Sentiment Strip (Side Indicator) -->
                <div class="absolute right-0 top-0 bottom-0 w-1 ${sColor} z-10"></div>
                
                <!-- Content (TEXT ONLY - No Image Block) -->
                <div class="p-4 flex-1 flex flex-col">
                    <div class="flex justify-between items-start mb-2 pl-2">
                        <span class="px-2 py-0.5 rounded text-[10px] font-bold border ${getTagStyles(item.tag || '')}">${item.tag || 'INFO'}</span>
                        <span class="text-[10px] text-gray-500 font-mono">${timeAgo(item.timestamp * 1000)}</span>
                    </div>

                    <h3 class="font-bold text-gray-100 text-base leading-snug mb-1">${item.title_fa}</h3>
                    <p class="text-[10px] text-gray-500 font-mono dir-ltr text-left mb-4 truncate">${item.title_en}</p>

                    <!-- AI Hidden Section -->
                    <div id="brief-${index}" class="hidden bg-black/40 rounded-lg p-4 mb-4 border-r-2 border-neon-purple text-sm animate-fade-in">
                        <span class="text-neon-purple text-[10px] font-bold tracking-widest block mb-2"><i class="fas fa-crosshairs mr-1"></i> STRATEGIC IMPACT</span>
                        <p class="text-gray-300 leading-relaxed mb-4 text-xs">${item.impact || 'در حال پردازش...'}</p>
                        <span class="text-neon-purple text-[10px] font-bold tracking-widest block mb-2"><i class="fas fa-list-ul mr-1"></i> SUMMARY</span>
                        <ul class="text-gray-400 list-disc pr-4 text-xs leading-relaxed">${summaryHTML}</ul>
                    </div>

                    <!-- Footer -->
                    <div class="mt-auto flex justify-between items-center pt-2 border-t border-white/5">
                        <div class="text-[10px] text-gray-500 flex items-center gap-1"><i class="fas fa-rss"></i> ${item.source}</div>
                        <div class="flex gap-2">
                            <button onclick="toggleBrief(${index})" id="btn-${index}" class="flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[10px] border border-white/10 text-gray-400 hover:text-neon-purple hover:border-neon-purple/50 hover:bg-neon-purple/10 transition-all">
                                <i class="fas fa-brain"></i> تحلیل هوشمند
                            </button>
                            <a href="${item.url}" target="_blank" class="p-1 text-gray-500 hover:text-neon-blue transition-colors text-sm">
                                <i class="fas fa-external-link-alt"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </article>
            `;
        });
        root.innerHTML = html;
    }

    function toggleBrief(idx) {
        const el = document.getElementById(`brief-${idx}`);
        const btn = document.getElementById(`btn-${idx}`);
        if(el.classList.contains('hidden')) {
            el.classList.remove('hidden');
            btn.classList.add('text-neon-purple', 'border-neon-purple/50', 'bg-neon-purple/10');
        } else {
            el.classList.add('hidden');
            btn.classList.remove('text-neon-purple', 'border-neon-purple/50', 'bg-neon-purple/10');
        }
    }

    function updateTicker() {
        const t = document.getElementById('ticker-content');
        let html = '';
        newsData.slice(0, 10).forEach(n => {
            html += `<div class="px-8 flex items-center gap-2 text-xs text-gray-400"><span class="text-neon-blue">⚡</span> ${n.title_fa} <span class="opacity-50">(${n.source})</span></div>`;
        });
        t.innerHTML = html + html; 
    }

    function updateTension(data) {
        const recent = data.slice(0, 15);
        if(!recent.length) return;
        let score = 0;
        recent.forEach(n => {
            if(n.tag === 'نظامی') score += 10;
            if(n.tag === 'هسته‌ای') score += 12;
            if(n.sentiment < -0.3) score += 5;
        });
        
        const pct = Math.min(score, 100);
        const fill = document.getElementById('tension-fill');
        const txt = document.getElementById('tension-text');
        
        fill.style.width = `${pct}%`;
        
        if(pct < 30) {
            fill.className = "h-full bg-neon-green w-0 transition-all duration-1000 ease-out shadow-[0_0_10px_currentColor]";
            txt.innerText = "LOW / عادی";
            txt.className = "text-xs font-black text-neon-green";
        } else if (pct < 65) {
            fill.className = "h-full bg-neon-orange w-0 transition-all duration-1000 ease-out shadow-[0_0_10px_currentColor]";
            txt.innerText = "ELEVATED / حساس";
            txt.className = "text-xs font-black text-neon-orange";
        } else {
            fill.className = "h-full bg-neon-red w-0 transition-all duration-1000 ease-out shadow-[0_0_15px_currentColor]";
            txt.innerText = "CRITICAL / بحرانی";
            txt.className = "text-xs font-black text-neon-red animate-pulse";
        }
    }

    function filterFeed(tag, btn) {
        currentFilter = tag;
        document.querySelectorAll('.chip').forEach(c => {
            c.className = "chip whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border border-white/10 text-gray-400 hover:border-white/30 hover:text-white transition-colors";
        });
        btn.className = "chip active whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium border transition-colors bg-gray-200 text-black border-gray-200";
        renderFeed();
    }

    function timeAgo(ms) {
        const diff = (new Date() - new Date(ms)) / 1000;
        if(diff < 60) return "لحظاتی پیش";
        if(diff < 3600) return Math.floor(diff/60) + " دقیقه پیش";
        if(diff < 86400) return Math.floor(diff/3600) + " ساعت پیش";
        return Math.floor(diff/86400) + " روز پیش";
    }

    // Init
    loadData();
    setInterval(loadData, 30000);
</script>
</body>
</html>
