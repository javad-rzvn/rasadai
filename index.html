<!DOCTYPE html>
<html lang="fa" dir="rtl" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رادار ایران | Iran Radar</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@33.003/misc/Farsi-Digits/Vazirmatn-FD-font-face.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --bg-body: #f3f4f6;
            --bg-card: #ffffff;
            --bg-modal: #ffffff;
            --text-main: #111827;
            --text-sub: #4b5563;
            --accent: #dc2626;
            --border: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        [data-theme="dark"] {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-modal: #1e293b;
            --text-main: #f3f4f6;
            --text-sub: #94a3b8;
            --accent: #ef4444;
            --border: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        body { font-family: 'Vazirmatn', sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; padding-bottom: 50px; }
        
        /* Nav */
        nav { background: var(--bg-card); padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index:10; }
        .brand { font-weight: 900; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .brand i { color: var(--accent); }

        /* Grid */
        .container { max-width: 1000px; margin: 20px auto; padding: 0 15px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        
        /* Card */
        .card { background: var(--bg-card); border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border); overflow: hidden; display: flex; flex-direction: column; }
        .card-body { padding: 20px; flex: 1; }
        .meta { font-size: 0.8rem; color: var(--text-sub); display: flex; justify-content: space-between; margin-bottom: 10px; }
        .source-badge { background: rgba(220, 38, 38, 0.1); color: var(--accent); padding: 2px 8px; border-radius: 6px; }
        h2 { margin: 0 0 10px 0; font-size: 1.1rem; line-height: 1.5; }
        p.summary { font-size: 0.9rem; color: var(--text-sub); line-height: 1.8; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        .card-footer { padding: 15px 20px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; }
        button { background: none; border: none; cursor: pointer; font-family: inherit; color: var(--text-sub); transition: 0.3s; }
        button:hover { color: var(--accent); }
        .read-btn { font-weight: bold; display: flex; align-items: center; gap: 5px; }

        /* --- MODAL FOR FULL TEXT --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px);
            z-index: 100; opacity: 0; visibility: hidden; transition: 0.3s;
            display: flex; justify-content: center; align-items: center;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal-content {
            background: var(--bg-modal); width: 90%; max-width: 700px; height: 85vh;
            border-radius: 16px; position: relative; display: flex; flex-direction: column;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transform: translateY(20px); transition: 0.3s;
        }
        .modal-overlay.active .modal-content { transform: translateY(0); }

        .modal-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: flex-start; }
        .close-btn { font-size: 1.5rem; color: var(--text-sub); padding: 0 10px; }
        
        .modal-body { padding: 30px; overflow-y: auto; line-height: 2; font-size: 1.05rem; white-space: pre-line; text-align: justify; }
        
        .modal-title { font-size: 1.4rem; font-weight: 900; margin-bottom: 10px; }
        .modal-meta { font-size: 0.85rem; color: var(--text-sub); margin-bottom: 20px; border-bottom: 2px solid var(--accent); display: inline-block; padding-bottom: 5px; }
        
        .skeleton { background: linear-gradient(90deg, var(--bg-card), var(--border), var(--bg-card)); background-size: 200%; animation: shimmer 1.5s infinite; border-radius: 6px; height: 15px; margin-bottom: 8px; }
        @keyframes shimmer { 0% {background-position: 200% 0;} 100% {background-position: -200% 0;} }
    </style>
</head>
<body>

    <nav>
        <div class="brand"><i class="fas fa-radar"></i> رادار ایران</div>
        <button onclick="toggleTheme()"><i class="fas fa-moon" id="theme-icon"></i></button>
    </nav>

    <div class="container">
        <div id="grid" class="grid">
            <!-- Loading State -->
            <div class="card"><div class="card-body"><div class="skeleton" style="height:20px; width:60%"></div><div class="skeleton" style="height:100px"></div></div></div>
            <div class="card"><div class="card-body"><div class="skeleton" style="height:20px; width:60%"></div><div class="skeleton" style="height:100px"></div></div></div>
        </div>
    </div>

    <!-- FULL TEXT MODAL -->
    <div class="modal-overlay" id="newsModal" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close-btn" onclick="closeModalDirect()">&times;</button>
                <div style="flex:1; padding-left:15px">
                    <h2 id="m-title" class="modal-title"></h2>
                    <span id="m-source" class="modal-meta"></span>
                </div>
            </div>
            <div id="m-body" class="modal-body">
                <!-- Text goes here -->
            </div>
        </div>
    </div>

    <script>
        let allData = [];

        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const target = current === 'light' ? 'dark' : 'light';
            html.setAttribute('data-theme', target);
            localStorage.setItem('theme', target);
        }
        if(localStorage.getItem('theme') === 'dark') toggleTheme();

        // 1. Fetch
        fetch('news.json?t='+Date.now()).then(r=>r.json()).then(data => {
            allData = data;
            render(data);
        });

        // 2. Render Grid
        function render(news) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            news.forEach((item, idx) => {
                grid.innerHTML += `
                <div class="card">
                    <div class="card-body">
                        <div class="meta">
                            <span class="source-badge">${item.source}</span>
                            <span>${new Date(item.date).toLocaleDateString('fa-IR')}</span>
                        </div>
                        <h2>${item.title_fa}</h2>
                        <p class="summary">${item.summary_fa}</p>
                    </div>
                    <div class="card-footer">
                        <button class="read-btn" onclick="openModal(${idx})">
                            <i class="fas fa-book-open"></i> مطالعه کامل خبر
                        </button>
                        <a href="${item.url}" target="_blank"><button><i class="fas fa-external-link-alt"></i></button></a>
                    </div>
                </div>`;
            });
        }

        // 3. Modal Logic
        function openModal(idx) {
            const item = allData[idx];
            document.getElementById('m-title').innerText = item.title_fa;
            document.getElementById('m-source').innerText = item.source + " | " + new Date(item.date).toLocaleDateString('fa-IR');
            
            // Handle Full Text formatting
            const textContent = item.full_text_fa ? item.full_text_fa : "متن کامل در دسترس نیست.";
            document.getElementById('m-body').innerText = textContent;

            document.getElementById('newsModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Stop background scrolling
        }

        function closeModal(e) {
            if (e.target.id === 'newsModal') closeModalDirect();
        }

        function closeModalDirect() {
            document.getElementById('newsModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    </script>
</body>
</html>
